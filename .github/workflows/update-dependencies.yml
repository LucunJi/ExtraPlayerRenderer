name: Update Dependencies
on:
  schedule:
    - cron: '15 14 * * 5'  # minute and hour are randomized to avoid peak hours
  workflow_dispatch:  # enables manual running this workflow
  push:

env:
  JAVA_VERSION: 17 # must be the same as the version used in build.gradle

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Update Dependencies
        id: depup
        uses: LucunJi/mc-depup@v0.0.1
        with:
          update_mc_patch: false
          update_only_with_mc: false
          tolerable: false

      # #   send file to other jobs using outputs when it is less than 50MB
      # #   so we don't need to repeat 'if' in each step
      # - name: Send Properties
      #   id: send_properties
      #   run: |
      #     properties="$(cat gradle.properties)"
      #     properties_escaped="${properties//$'\n'/\\n}"
      #     properties_escaped="${properties_escaped//$'\r'/\\r}"
      #     echo "properties=$properties_escaped" >> "$GITHUB_OUTPUT"
  
      - name: Setup Java
        if: ${{ steps.depup.outputs.any_update }}
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: ${{ env.JAVA_VERSION }}

      - name: Build
        if: ${{ steps.depup.outputs.any_update }}
        id: build
        run: |
          chmod +x ./gradlew
          ./gradlew clean build
      
      - name: Pull Request
        if: ${{ steps.depup.outputs.any_update }}
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.PERSONAL_ACCESS_TOKEN  }}
          add-paths: gradle.properties
          commit-message: Update dependencies
          title: Update dependencies

